sudo: required

language: generic

services:
  - docker

env:
  global:
  - secure: d6pliM7iR7KJ3TQkr1C0tHi0HgU6Vdmc/ycw11XrXs794/dgj6g9UDrhgcvT2mTzOVIUNouHx7gyEWAlwJv7p8PPyguHJfIsyqMWfaXNPoytTx1ETUiygl1G/UsvXVdry6I5tZF/U+/PJ3hBXoAvo8EOFe0/MxxvP3ghCeeCpeEwEdoYP2jbADGffywVUNI7OEdmS29A28GusXXp2cWCIZYSq5Gn5iu1ZMPaJA6SkRTXpS+iVVLUvlbz5HW09ETFfurTvsdz5Ze4JICiuQt///CR1uwdxD8K7Ils/mkenaMtja9NHA9RdQBa51Azn8iCLsObCTYc52Zb6atbCi/X4ae9M8GA8qaaLigNz5G4v1BHneJylYfWKj5GwqUA3VmRu1mlEw7d2sN2uFRmgIl5kgsYYyOVOLBOKaJWhyBhNnR4U8KeqwUkOnlSdmNZnjfexXXBEcKHen1SozpXwMnzZh8LZuN6BNYd6TVpKmjulGI3vqNMM0c4JJZ9pSm4q5FjbNGQArwCsujDDwY4bCGZSJJTPMXjYOrx4yJ1RY+0TpyV9oDU3ogEqaWnhrkgrphfiYBlDY2bEvrxMTMukLCxJb0Nru6LGCpg4X1P9hu9r0gceqUSnBgdJI4rYTNddenxlEd4j/Thqv835stJWz6YoV+rfvERuSUpntl8xvrk3U8=
  - secure: CmLh169xwt3OC7l19lDUwdZYfw+l/+XXKjTGxnuJiXHa9hAH+nc4mEUSmqHMHwjquyYE6LnSVGZ94LH8sCaGed/TMm0Lj3DZtZ0VsjYu3sKsNrVJn5WdYEah+GvNJ8i8uzvHnGk1L2fAagLpXFUB2K9UraA1CFiHs1fF5Fua7Ra0mE7lMz0MFvyvzcmc9u8nMz71K2YVsXqn+I/rv8onJCTtc/Ds0hVrBXwG5Fh0T3xHqjOhME9ZI2hRHnnQVdBojSY3USifQ//qAKowfBVc0pebEtgFpyXx/I17A6xCm0KVtnA2tNqu1+XFkjWaBzryaLE9ujhJcTRC/YK0JUZ+QxfYbD5C7jVy9Jlx1lOEjJ42B/ImNxPP+9p3wi2MWNbcbZJPxIe635fnT17lI7CLK2Qg1xjfTQ4WTEKW5IhnYMiyfRKiripFh4PCkDm8cJlTbpntsX1n0uheydbsgf/11vS7o1WGhVQ8+Jelc4DvIbBHCqienQEOLJDBwm7FiK5JbwZJ6ZAGeDM/IhGU1h9PNjVbHUyJhUxYoPYUE9QsZFT7ENCrRQpq49KOzXBRfffyJNJRh+Ep9X5YoW0dUp0MNu5B7z2+6w9X9n/C+loa11xF42bFzniCvvbSOQ37J+EngDinVxJkNPeyivR4fye2ENhIAjAEjouTJLOSXL9nAOU=
  - secure: e5F470jg5zS9LKKEl5GpOBPBHncKTsqh0rWW4s73h/ts4E9JLcaSNBk+3+2t35zA+FYMCYcLAUJGrBQgk02jQccE8Rvueaofyt7GLuZtsS4eaDC2t9NX3Y0KrktghBV+m+xIcTx2weYokrpJLceChYti5/6XnL4h9XZ/P1xnOsOyystpJfJPkUBUqVGcuRaIUPLFu4hhDyIZNSkaUmbr/MWa3CfuY9q4ZBQFfWL2/Hypz+idRPwVUWCUc4uVUrtr7xwuYz4HK+XeAMkQrSvQutffm/PV+HtN48uVtcELBDvXlopXuQwREOTJJWZsWBxKcVJavUcsknjswTbGoIVULBSgh96ndzmJ4OCHQFcXEJSJhyiZwpzsu55ajDjXcyTR3GYbWDZFlSesTbhDp3le1YtPs0JuFw5VNMvSNaX7zx3ad00EjRcp9fPIYM+pSzQMkUZpN29NAk0wQmVYycWj9qpoCvzejNbRHobIVahigaJ1hmr1Ir2gmAYW4FxdiDWpVkAJDMdlI1qElLf5gloro0tVImasVpWu5AEc6+oId5Rn52AbImr7ecspuuJjESYBR6iRwN0adNayJgPJFzs/dACnGudh8Fi5TP7b32SxvrDguwDrAdFQQTVSYrOko3KNtnDpsfdsoMmDzwKpUNNEU8eRpkVH8Rbyn3VpAmEd3dI=
  - secure: a7/0xF8MilcI0iyGwXR+B/T+Vv9Q60UZhnNcYFg7ijBiDL3PNzs0H6uwaCnZXPdCtYh2ycLKj1aSJ9TI036dQw1wGnBvhWuZmpKWuD4fcS3J/2X/e7FesdpJdm3PSXPIE0oRSJUny5DjBtA/Z0dV+51EL7aBBqotyievwQnruztOkObLbOEausdJ/d4iKB2toaJaHTj8JxsXuY5MLnvSLVmmUKKZB7Lr827HMY+yQ1xdshMPrn6iYNbfSk28YuJ3J4W0JqVXkp/H6rBTJC90o+gb4VlJibbNWAam3pDBRaaOhyaQbQrIcxhlMZAJwoeaQ/TkYnMFZ6giJhhN4mKIQMNdmgc2/+rf9NzLOBUgnuiCRUYoUfo9vvAZrAqh1Aj1sacuqLMV08eDBBuL4Cq8oGJiim5EQBlfBOOMAgQFOQrS1WwKiCDzZr/l5XXgABYsi5iwXtMo8v0hCW/9w7bq23wmwOwrJqsEEcd5DPEUAAxHL2dcch/dYWApCHtwyJbfHB+OdumxkxidIdm/nXNGmq2/2io5VJfIyckUAV8Bl7wavQVOuPOpoxudOb+jB3R8jNMquM+hq9XGN2M/bFIrg5j3knec4zPURH2Uk5ifxrgm81zzTqJyxhe6hv5+QKvwzxlXGgLUtIW7VLrNz2k52g2IWQ4sch4nvPZHrnXoLGk=

before_install:
  - wget -qO- https://github.com/gulien/orbit/releases/download/v3.0.0/orbit_Linux_x86_64.tar.gz | tar xvz -C .
  - sudo mv ./orbit /usr/local/bin && chmod +x /usr/local/bin/orbit

script:
  - orbit run ci -p "Version,${TRAVIS_BRANCH}"
  - orbit run build -p "Version,${TRAVIS_BRANCH}"
  # Uploads coverage.
  - bash <(curl -s https://codecov.io/bash)
  # Let's push to Docker hub only if not in a pull request and the branch name matches the semver format.
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - if [[ "$TRAVIS_PULL_REQUEST" = false && "$TRAVIS_BRANCH" =~ ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(-(0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(\.(0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*)?(\+[0-9a-zA-Z-]+(\.[0-9a-zA-Z-]+)*)?$ ]]; then docker push sdemiguel/gotenberg:${TRAVIS_BRANCH}; fi
